<!DOCTYPE html>
<html>
<head>
    <title>Productos - Belleza Eva</title>
    <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet">
</head>

<body style="background-color:#d16fed;">

<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a href="index.html" class="navbar-brand fw-bold">
            üå∏ Belleza Eva
        </a>

        <div class="d-flex gap-2">
            <a href="index.html" class="btn btn-outline-light">
                ‚Üê Inicio
            </a>

            <a href="cart.html" class="btn btn-outline-warning">
                üõí Carrito
            </a>
        </div>
    </div>
</nav>

<div class="container mt-4">
    <h2 class="mb-4 text-center">Productos Disponibles</h2>

    <div class="row mb-4">
        <div class="col-md-6 mx-auto">
            <input 
                type="text"
                id="searchInput"
                class="form-control form-control-lg"
                placeholder="üîç Buscar productos de belleza...">
        </div>
    </div>

    <div id="productsList" class="row"></div>
</div>

<script>
let allProducts = [];

fetch("http://127.0.0.1:8000/api/products")
.then(res => res.json())
.then(products => {
    allProducts = products;
    renderProducts(products);
});

function renderProducts(products) {
    let html = "";

    if (products.length === 0) {
        html = `<p class="text-center">No se encontraron productos üò¢</p>`;
    }

    products.forEach(p => {
        html += `
        <div class="col-md-4 mb-4">
            <div class="card h-100 shadow-sm">

                <img src="${p.image_url}" 
                     class="card-img-top"
                     style="height:250px; object-fit:cover;">

                <div class="card-body d-flex flex-column">
                    <h5 class="card-title">${p.name}</h5>
                    <p class="card-text">${p.description ?? ''}</p>
                    <p class="fw-bold text-success">$${p.price}</p>

                    <button 
                        class="btn btn-outline-warning mt-auto"
                        onclick="addToFavorites(${p.id})">
                        ‚≠ê Favoritos
                    </button>

                    <button 
                        class="btn btn-outline-success mt-2"
                        onclick="addToCart(${p.id})">
                        üõí Agregar al carrito
                    </button>

                    <a href="product.html?id=${p.id}" 
                       class="btn btn-primary mt-2">
                        üí¨ Ver detalles
                    </a>
                </div>
            </div>
        </div>`;
    });

    document.getElementById("productsList").innerHTML = html;
}

// BUSCADOR
document.getElementById("searchInput").addEventListener("keyup", function() {
    const search = this.value.toLowerCase();

    const filtered = allProducts.filter(p =>
        p.name.toLowerCase().includes(search) ||
        (p.description && p.description.toLowerCase().includes(search))
    );

    renderProducts(filtered);
});

// FAVORITOS
function addToFavorites(productId) {
    let favorites = JSON.parse(localStorage.getItem("favorites")) || [];

    if (!favorites.includes(productId)) {
        favorites.push(productId);
        localStorage.setItem("favorites", JSON.stringify(favorites));
        alert("Producto agregado a favoritos ‚≠ê");
    } else {
        alert("Este producto ya est√° en favoritos");
    }
}

// CARRITO
function addToCart(productId) {
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    cart.push(productId);
    localStorage.setItem("cart", JSON.stringify(cart));

    alert("Producto agregado al carrito üõí");
}
</script>

</body>
</html>
