<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Bienvenida - Belleza Eva</title>

    <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet">
    
    <style>
    .hero-section {
        min-height: 70vh;
        background-image: 
            linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)),
            url("https://images.unsplash.com/photo-1522335789203-aabd1fc54bc9");
        background-size: cover;
        background-position: center;
    }
    </style>
</head>

<body style="background-color:#d66ef5;">


<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container">
        <a href="index.html" class="navbar-brand fw-bold">
            ğŸŒ¸ Belleza Eva
        </a>
        
        <div class="d-flex gap-2">
            <span id="userGreeting" class="text-light me-3" style="display:none;">
                ğŸ‘¤ <span id="userName"></span>
            </span>
            
            <button id="adminBtn" class="btn btn-warning btn-sm" style="display:none;" 
                    onclick="goToAdmin()">
                âš™ï¸ Panel Admin
            </button>

            <button id="loginBtn" class="btn btn-outline-light btn-sm" 
                    data-bs-toggle="modal" data-bs-target="#loginModal">
                ğŸ” Login
            </button>

            <button id="logoutBtn" class="btn btn-outline-danger btn-sm" style="display:none;"
                    onclick="logout()">
                ğŸšª Logout
            </button>
        </div>
    </div>
</nav>

<!-- HERO -->
<!-- HERO CON IMAGEN -->
<section class="hero-section d-flex align-items-center text-center text-white">
    <div class="container">
        <h1 class="display-4 fw-bold mb-3">
            Belleza que cuida de ti âœ¨
        </h1>

        <p class="lead mb-4">
            Productos de cuidado personal, belleza y bienestar para ti.
        </p>

        <div class="d-flex justify-content-center gap-3 flex-wrap">
            <a href="products.html" class="btn btn-success btn-lg px-4">
                Ver Productos
            </a>

            <a href="favorites.html" class="btn btn-warning btn-lg px-4">
                Mis Favoritos
            </a>
        </div>
    </div>
</section>


<!-- INFO -->
<section class="container my-5">
    <div class="row text-center">
        <div class="col-md-4 mb-4">
            <h5 class="fw-bold">ğŸŒ¿ Productos Naturales</h5>
            <p>Seleccionados para el cuidado de tu piel y bienestar.</p>
        </div>

        <div class="col-md-4 mb-4">
            <h5 class="fw-bold">ğŸšš Entrega RÃ¡pida</h5>
            <p>Compra fÃ¡cil y segura desde cualquier lugar.</p>
        </div>

        <div class="col-md-4 mb-4">
            <h5 class="fw-bold">â­ Favoritos</h5>
            <p>Guarda los productos que mÃ¡s te gustan.</p>
        </div>
    </div>
</section>


<!-- API EXTERNA - GATITOS -->
<section class="container mb-5 d-flex justify-content-center">
    <div class="card shadow-lg text-center bg-light bg-opacity-75 border-0">
        <div class="card-body">
            <h5 class="fw-bold mb-3">ğŸ± Gatito del dÃ­a</h5>

            <img   
              id="catImage"
              src=""
              class="img-fluid rounded-4 mb-3"
              style="max-height:300px; object-fit:cover;"
              alt="Gatito aleatorio">

            <br>

            <button class="btn btn-outline-primary" onclick="loadCat()">
                Ver otro gatito ğŸ˜»
            </button>
        </div>
    </div>
</section>

<script>
function loadCat() {
    fetch("https://api.thecatapi.com/v1/images/search")
        .then(res => res.json())
        .then(data => {
            document.getElementById("catImage").src = data[0].url;
        })
        .catch(() => {
            alert("No se pudo cargar el gatito ğŸ˜¿");
        });
}

// Cargar uno al iniciar
loadCat();
</script>


<!-- CLIMA -->
<section class="container mb-5">
    <div class="card shadow-sm">
        <div class="card-body text-center">
            <h5 class="fw-bold mb-2">ğŸŒ¦ï¸ Clima actual en Quito</h5>
            <p id="weatherInfo" class="mb-0">
                Cargando clima...
            </p>
        </div>
    </div>
</section>

<script>
fetch("https://api.open-meteo.com/v1/forecast?latitude=-0.1807&longitude=-78.4678&current_weather=true")
    .then(res => res.json())
    .then(data => {
        const temp = data.current_weather.temperature;
        document.getElementById("weatherInfo").innerText =
            `Temperatura actual: ${temp}Â°C`;
    })
    .catch(() => {
        document.getElementById("weatherInfo").innerText =
            "No se pudo cargar el clima.";
    });
</script>


<!-- FOOTER -->
<footer class="bg-dark text-light text-center py-3">
    <small>
        Â© 2025 Belleza Eva Â· Proyecto AcadÃ©mico
    </small>
</footer>

<!-- MODAL DE LOGIN / REGISTRO -->
<div class="modal fade" id="loginModal" tabindex="-1">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modalTitle">ğŸ” Inicia SesiÃ³n</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            
            <div class="modal-body">
                <!-- FORM LOGIN -->
                <form id="loginForm" style="display:block;">
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="loginEmail" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ContraseÃ±a</label>
                        <input type="password" class="form-control" id="loginPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-100">Ingresar</button>
                </form>

                <!-- FORM REGISTRO -->
                <form id="registerForm" style="display:none;">
                    <div class="mb-3">
                        <label class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="registerName" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="registerEmail" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">ContraseÃ±a</label>
                        <input type="password" class="form-control" id="registerPassword" required>
                    </div>
                    <button type="submit" class="btn btn-success w-100">Crear Cuenta</button>
                </form>

                <hr>
                <p class="text-center text-muted">
                    <small>
                        <a href="#" onclick="toggleForms()" class="link-primary">
                            Cambiar a <span id="formToggleText">registro</span>
                        </a>
                    </small>
                </p>

                <!-- Credenciales de prueba -->
                <div class="alert alert-info alert-sm" role="alert">
                    <small>
                        <strong>Prueba:</strong><br>
                        Admin: admin@example.com / password123<br>
                        Usuario: test@example.com / password
                    </small>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const API_URL = "http://127.0.0.1:8000/api";

// Verificar sesiÃ³n al cargar
window.addEventListener('load', () => {
    checkSession();
    setupEventListeners();
});

// Configurar los event listeners despuÃ©s de cargar el DOM
function setupEventListeners() {
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    
    if (loginForm) {
        loginForm.addEventListener('submit', handleLogin);
    }
    
    if (registerForm) {
        registerForm.addEventListener('submit', handleRegister);
    }
}

// Verificar si hay sesiÃ³n activa
function checkSession() {
    const token = localStorage.getItem('token');
    const userData = localStorage.getItem('userData');
    
    if (token && userData) {
        const user = JSON.parse(userData);
        document.getElementById('userGreeting').style.display = 'inline-block';
        document.getElementById('userName').textContent = user.name;
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('logoutBtn').style.display = 'inline-block';
        
        // Mostrar botÃ³n admin si es admin
        if (user.role === 'admin') {
            document.getElementById('adminBtn').style.display = 'inline-block';
        }
    } else {
        document.getElementById('userGreeting').style.display = 'none';
        document.getElementById('loginBtn').style.display = 'inline-block';
        document.getElementById('logoutBtn').style.display = 'none';
        document.getElementById('adminBtn').style.display = 'none';
    }
}

// Cambiar entre login y registro
function toggleForms() {
    const loginForm = document.getElementById('loginForm');
    const registerForm = document.getElementById('registerForm');
    const modalTitle = document.getElementById('modalTitle');
    const toggleText = document.getElementById('formToggleText');
    
    if (loginForm.style.display === 'block') {
        loginForm.style.display = 'none';
        registerForm.style.display = 'block';
        modalTitle.textContent = 'ğŸ“ Crear Cuenta';
        toggleText.textContent = 'login';
    } else {
        loginForm.style.display = 'block';
        registerForm.style.display = 'none';
        modalTitle.textContent = 'ğŸ” Inicia SesiÃ³n';
        toggleText.textContent = 'registro';
    }
}

// LOGIN
async function handleLogin(e) {
    e.preventDefault();
    
    const email = document.getElementById('loginEmail').value;
    const password = document.getElementById('loginPassword').value;
    
    console.log('Intentando login con:', email);
    
    try {
        const response = await fetch(`${API_URL}/login`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({ email, password })
        });

        console.log('Respuesta status:', response.status);
        const data = await response.json();
        console.log('Datos recibidos:', data);

        if (!response.ok) {
            alert('âŒ Error: ' + (data.message || 'Credenciales invÃ¡lidas'));
            return;
        }

        // Guardar token y datos del usuario
        localStorage.setItem('token', data.token);
        localStorage.setItem('userData', JSON.stringify(data.user));

        alert('âœ… Â¡Bienvenido ' + data.user.name + '!');
        
        // Limpiar formulario
        document.getElementById('loginForm').reset();
        document.getElementById('loginEmail').value = '';
        document.getElementById('loginPassword').value = '';
        
        // Cerrar modal usando Bootstrap
        const modalElement = document.getElementById('loginModal');
        const modalInstance = bootstrap.Modal.getInstance(modalElement);
        if (modalInstance) {
            modalInstance.hide();
        } else {
            // Si no existe instancia, crear una nueva y cerrarla
            new bootstrap.Modal(modalElement).hide();
        }
        
        // Actualizar UI
        checkSession();

    } catch (error) {
        console.error('Error de login:', error);
        alert('âŒ Error: ' + error.message);
    }
}

// REGISTRO
async function handleRegister(e) {
    e.preventDefault();
    
    const name = document.getElementById('registerName').value;
    const email = document.getElementById('registerEmail').value;
    const password = document.getElementById('registerPassword').value;
    
    console.log('Intentando registro:', name, email);
    
    try {
        const response = await fetch(`${API_URL}/register`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'Accept': 'application/json'
            },
            body: JSON.stringify({ name, email, password })
        });

        const data = await response.json();

        if (!response.ok) {
            alert('âŒ Error: ' + (data.message || 'Error al registrarse'));
            return;
        }

        alert('âœ… Cuenta creada. Por favor inicia sesiÃ³n.');
        
        // Cambiar a formulario de login
        document.getElementById('registerForm').style.display = 'none';
        document.getElementById('loginForm').style.display = 'block';
        document.getElementById('modalTitle').textContent = 'ğŸ” Inicia SesiÃ³n';
        document.getElementById('formToggleText').textContent = 'registro';
        
        // Llenar email en login
        document.getElementById('loginEmail').value = email;
        document.getElementById('loginPassword').value = '';

    } catch (error) {
        console.error('Error de registro:', error);
        alert('âŒ Error: ' + error.message);
    }
}

// LOGOUT
function logout() {
    const token = localStorage.getItem('token');
    
    fetch(`${API_URL}/logout`, {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/json'
        }
    })
    .then(res => {
        localStorage.removeItem('token');
        localStorage.removeItem('userData');
        checkSession();
        alert('âœ… SesiÃ³n cerrada');
    })
    .catch(error => {
        localStorage.removeItem('token');
        localStorage.removeItem('userData');
        checkSession();
    });
}

// Ir a panel admin
function goToAdmin() {
    window.location.href = 'admin.html';
}
</script>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

</body>
</html>
