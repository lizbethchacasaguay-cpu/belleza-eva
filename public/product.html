<!DOCTYPE html>
<html>
<head>
    <title>Detalle del Producto</title>
    <link 
        href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        rel="stylesheet">
</head>

<body style="background-color:#d873fa;">

<nav class="navbar navbar-dark bg-dark">
    <div class="container">
        <a href="products.html" class="navbar-brand">â† Volver</a>
    </div>
</nav>

<div class="container mt-4">
    <div id="productDetail"></div>

    <hr>

    <h4 class="mt-4">ğŸ’¬ Comentarios</h4>

        <div id="commentsList" class="mb-3"></div>

        <input 
            type="text"
            id="userName"
            class="form-control mb-2"
            placeholder="ğŸ‘¤ Tu nombre">

        <textarea 
            id="commentText"
            class="form-control mb-2"
            placeholder="ğŸ’­ Escribe tu comentario"></textarea>

    <button class="btn btn-pink w-100" onclick="addComment()">
    Enviar comentario
    </button>


</div>

<script>
const params = new URLSearchParams(window.location.search);
const productId = params.get("id");

// Cargar comentarios
function loadComments() {
    fetch(`http://127.0.0.1:8000/api/comments/product/${productId}`)
    .then(res => res.json())
    .then(comments => {
        let html = "";

        comments.forEach(c => {
            html += `
            <div class="border rounded p-2 mb-2 bg-light">
                <strong>ğŸ‘¤ ${c.user_name}</strong>
                <p class="mb-0">${c.comment}</p>
            </div>`;
        });

        document.getElementById("commentsList").innerHTML = html;
    });
}

loadComments();

// Guardar comentario
function addComment() {
    fetch("http://127.0.0.1:8000/api/comments", {
        method: "POST",
        headers: {
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            product_id: productId,
            user_name: document.getElementById("userName").value,
            comment: document.getElementById("commentText").value
        })
    })
    .then(res => res.json())
    .then(() => {
        document.getElementById("commentText").value = "";
        loadComments();
    });
}
</script>


</body>
</html>
