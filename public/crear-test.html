<!DOCTYPE html>
<html>
<head>
    <title>Crear Producto de Prueba</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background: #f0f0f0; }
        .container { max-width: 600px; background: white; padding: 30px; border-radius: 8px; }
        h1 { color: #333; margin-bottom: 30px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
    </style>
</head>
<body>

<div class="container">
    <h1>üñºÔ∏è Crear Producto de Prueba</h1>
    
    <form id="testForm">
        <div class="mb-3">
            <label class="form-label">Nombre</label>
            <input type="text" class="form-control" id="nombre" value="Producto Test" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Precio</label>
            <input type="number" class="form-control" id="precio" value="99.99" step="0.01" required>
        </div>

        <div class="mb-3">
            <label class="form-label">Descripci√≥n</label>
            <textarea class="form-control" id="descripcion" rows="3">Producto de prueba para verificar que las im√°genes se cargan correctamente</textarea>
        </div>

        <div class="mb-3">
            <label class="form-label">üì∏ Selecciona una imagen</label>
            <input type="file" class="form-control" id="imagen" accept="image/*" required>
            <small class="text-muted">JPG, PNG, etc. (m√°x 2MB)</small>
        </div>

        <button type="submit" class="btn btn-success btn-lg w-100">Crear Producto</button>
    </form>

    <div id="result" style="margin-top: 20px;"></div>
</div>

<script>
const API_BASE = "http://127.0.0.1:8000/api";

document.getElementById('testForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '<p>Creando producto...</p>';
    
    const formData = new FormData();
    formData.append('name', document.getElementById('nombre').value);
    formData.append('price', document.getElementById('precio').value);
    formData.append('description', document.getElementById('descripcion').value);
    formData.append('image', document.getElementById('imagen').files[0]);

    const token = localStorage.getItem('token');
    
    if (!token) {
        resultDiv.innerHTML = '<p class="error">‚ùå Debes estar logueado como admin</p>';
        return;
    }

    try {
        const response = await fetch(`${API_BASE}/products`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${token}`
            },
            body: formData
        });

        const data = await response.json();

        if (response.ok) {
            resultDiv.innerHTML = `
                <p class="success">‚úÖ Producto creado exitosamente!</p>
                <p><strong>ID:</strong> ${data.product.id}</p>
                <p><strong>Nombre:</strong> ${data.product.name}</p>
                <p><strong>URL Imagen:</strong> <code>${data.product.image_url}</code></p>
                <p><strong>Pr√≥ximos pasos:</strong></p>
                <ul>
                    <li><a href="products.html" target="_blank">Ver en cat√°logo</a></li>
                    <li><a href="test-firebase.html" target="_blank">Verificar im√°genes</a></li>
                </ul>
            `;
            document.getElementById('testForm').reset();
        } else {
            resultDiv.innerHTML = `<p class="error">‚ùå Error: ${data.message || 'Error desconocido'}</p>`;
        }
    } catch (error) {
        resultDiv.innerHTML = `<p class="error">‚ùå Error de conexi√≥n: ${error.message}</p>`;
    }
});
</script>

</body>
</html>
