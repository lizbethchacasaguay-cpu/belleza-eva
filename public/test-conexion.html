<!DOCTYPE html>
<html>
<head>
    <title>Test Conexi√≥n Firebase</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { padding: 20px; background: #f0f0f0; }
        .container { max-width: 700px; background: white; padding: 30px; border-radius: 8px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .loading { color: blue; }
        pre { background: #f5f5f5; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto; }
    </style>
</head>
<body>

<div class="container">
    <h1>üî• Test Firebase Conexi√≥n</h1>
    
    <div class="alert alert-info">
        <strong>Instrucciones:</strong> Haz clic en el bot√≥n para probar si Firebase est√° funcionando correctamente.
    </div>

    <button onclick="testFirebase()" class="btn btn-primary btn-lg w-100">Probar Conexi√≥n Firebase</button>

    <div id="result" style="margin-top: 30px;"></div>
</div>

<script>
const API_BASE = "http://127.0.0.1:8000/api";

function testFirebase() {
    const resultDiv = document.getElementById('result');
    resultDiv.innerHTML = '<p class="loading">‚è≥ Probando conexi√≥n con Firebase...</p>';
    
    const token = localStorage.getItem('token');
    
    if (!token) {
        resultDiv.innerHTML = `
            <p class="error">‚ùå No est√°s logueado</p>
            <p>Primero debes iniciar sesi√≥n como admin en <a href="index.html">index.html</a></p>
        `;
        return;
    }

    // Crear un producto de prueba
    fetch(`${API_BASE}/products`, {
        method: 'POST',
        headers: {
            'Authorization': `Bearer ${token}`,
            'Content-Type': 'application/x-www-form-urlencoded'
        },
        body: new URLSearchParams({
            'name': 'Test Firebase',
            'price': '99.99',
            'description': 'Producto de prueba para verificar Firebase'
        })
    })
    .then(res => res.json())
    .then(data => {
        if (data.message && data.message.includes('√©xito')) {
            resultDiv.innerHTML = `
                <p class="success">‚úÖ Firebase est√° funcionando!</p>
                <p><strong>Producto creado:</strong> ${data.product.name}</p>
                <p><strong>ID:</strong> ${data.product.id}</p>
                <p><strong>Precio:</strong> $${data.product.price}</p>
                <p><strong>URL Imagen:</strong> ${data.product.image_url || 'Sin imagen (normal sin archivo)'}</p>
                <div class="alert alert-success mt-3">
                    Firebase est√° conectado correctamente. Ahora puedes crear productos con im√°genes.
                </div>
                <p><strong>Pr√≥ximo paso:</strong> <a href="crear-test.html" class="btn btn-success">Crear Producto con Imagen</a></p>
            `;
        } else {
            resultDiv.innerHTML = `
                <p class="error">‚ùå Error: ${data.message || 'Error desconocido'}</p>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
        }
    })
    .catch(err => {
        resultDiv.innerHTML = `
            <p class="error">‚ùå Error de conexi√≥n: ${err.message}</p>
            <p>Aseg√∫rate que:</p>
            <ul>
                <li>El servidor Laravel est√° corriendo</li>
                <li>Tienes un token v√°lido</li>
                <li>Los certificados SSL est√°n descargados</li>
            </ul>
        `;
    });
}
</script>

</body>
</html>
